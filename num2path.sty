% <*sty>
% <*@@=ntp>

\NeedsTeXFormat{LaTeX2e}

\def \ntp@date    {2025-07-22}
\def \ntp@version {1.0.0}

\ProvidesExplPackage {num2path} {\ntp@date} {\ntp@version}
  {Convert numbers to tikz path}

\cs_new_protected_nopar:Npn \@@_load_font_data:n #1 
  {
    \clist_map_inline:nn {#1}
      {
        \file_get:nnNTF {ntp-##1.def.tex} {} \l_@@_token_list
          {
            \exp_args:NNV
            \prop_const_from_keyval:Nn \c_numtopath_tikz_data_prop
              { \l_@@_token_list }
          }
          {
            \__kernel_msg_error:nnn { kernel } { file-not-found }
              {ntp-##1.def.tex}
          }
      }
  }

\cs_new_protected_nopar:Npn \@@_provide_data:n #1
  {
    \ProvidesExplFile{ntp-##1.def.tex}{\ntp@date}{\ntp@version}
      {num2path ~ \text_titlecase:n {#1} ~ Data}
  }

\keys_define:nn { num2path }
  {
    scale .tl_gset:N = \g__numtopath_scale_tl,
    scale .initial:n = { 10pt },
  }
\ProcessKeyOptions [ num2path ]

% env setup

\RequirePackage{tikz}
\usetikzlibrary{patterns, fadings}

\RequirePackage{etoolbox}

\patchcmd{\pgfutil@InputIfFileExists}
  { \input #1 }
  {
    \@pushfilename
    \xdef\@currname{#1}
    \input #1
    \@popfilename
  }{}{}

\tl_const:Nn \c_numtopath_tikz_folder_tl { lmm_nums_tikz }

\prop_const_from_keyval:Nn \c_numtopath_scale_prop
  {
    10pt = 0.820, % basic scale factor
    11pt = 0.902,
    12pt = 0.984,
    13pt = 1.066,
    14pt = 1.148,
    15pt = 1.230,
    16pt = 1.311,
  }

% path data (0, 1, 2, 3, ..., 9)

\@@_load_font_data:n {num}

% user interface (basic)

\NewDocumentCommand \numtopath
  { O {
      draw = black,
      line~width = .003cm
    } m
  }{
    \tl_map_inline:nn {#2}
      {
        \exp_args:Nee \__num_to_path_draw:nn 
          {#1} { \__num_to_path_data:e {##1} }
      }
  }
\cs_new_protected:Npn \__num_to_path_draw:nn #1#2
  {
    \tikz
      \node [ inner~sep = 0pt, minimum~width = 1.5ex,
              scale = \prop_item:Ne \c_numtopath_scale_prop 
                        { \g__numtopath_scale_tl }
            ] {\tikz \path[#1] #2;};
  }

\cs_new:Npn \__num_to_path_data:n #1

  {

    \prop_item:Nn \c_numtopath_tikz_data_prop { #1 }

    % \file_if_exist_input:n

    %   { \c_numtopath_tikz_folder_tl/lmm_#2.tikz }

  }

\cs_generate_variant:Nn \__num_to_path_data:n { e }


% user interface (fading)

\keys_define:nn { num2path / numfading }
  {
    colorset    .clist_set:N  = \l_@@_numfading_color_clist,
      colorset  .initial:n    = {black, white},
    direction   .tl_set:N     = \l_@@_numfading_direction_tl,
      direction .initial:n    = east,
  }
\tl_set:Nn \l_@@_numfading_direction_north_tl { north }
\tl_set:Nn \l_@@_numfading_direction_south_tl { south }

\clist_new:N \l_@@_continous_color_left_clist
\clist_new:N \l_@@_continous_color_right_clist
\seq_new:N \l_@@_numfading_tmp_seq

\NewDocumentCommand \numfading { O{} m }
  {
    \group_begin:
    \keys_set:nn { num2path / numfading } {#1}
    \@@_continous_colorset_aux:NNN \l_@@_numfading_color_clist
      \l_@@_numfading_color_i_tl \l_@@_numfading_color_ii_tl
    \@@_continous_color_aux:nNN {#2}
      \l_@@_continous_color_left_clist
      \l_@@_continous_color_right_clist
    \seq_set_split:Nnn \l_@@_numfading_tmp_seq {} {#2}
    \int_step_inline:nn { \tl_count:n {#2} }
      {
        \tl_set:Nn \l_@@_continous_color_tmpa_tl
          { \clist_item:Nn \l_@@_continous_color_left_clist {##1} }
        \tl_set:Nn \l_@@_continous_color_tmpb_tl
          { \clist_item:Nn \l_@@_continous_color_right_clist {##1} }
        \tl_set:Nn \l_@@_continous_color_tmpc_tl
          { \seq_item:Nn \l_@@_numfading_tmp_seq {##1} }
        \str_case_e:nnT { \l_@@_numfading_direction_tl }
          { { north } {} { south } {} }
          {
            \numtopath
              [
                fill = \l_@@_numfading_color_tl,
                path ~ fading = \l_@@_numfading_direction_tl
              ] { \l_@@_continous_color_tmpc_tl }
          }
        \str_if_eq:eeT { \l_@@_numfading_direction_tl } { horizontal }
          {
            \numtopath
              [
                left  ~ color =
                  \fp_compare:nNnTF
                    { \fp_eval:n { 100 - \l_@@_continous_color_tmpa_tl } } <
                    { \l_@@_continous_color_tmpa_tl }
                    {
                      \l_@@_numfading_color_ii_tl!
                      \fp_eval:n { 100 - \l_@@_continous_color_tmpa_tl }!
                      \l_@@_numfading_color_i_tl!\l_@@_continous_color_tmpa_tl,
                    }
                    {
                      \l_@@_numfading_color_i_tl!\l_@@_continous_color_tmpa_tl!
                      \l_@@_numfading_color_ii_tl!
                      \fp_eval:n { 100 - \l_@@_continous_color_tmpa_tl },
                    }
                ,
                right ~ color =
                  \fp_compare:nNnTF
                    { \fp_eval:n { 100 - \l_@@_continous_color_tmpb_tl } } <
                    { \l_@@_continous_color_tmpb_tl }
                    {
                      \l_@@_numfading_color_ii_tl!
                      \fp_eval:n { 100 - \l_@@_continous_color_tmpb_tl }!
                      \l_@@_numfading_color_i_tl!
                      \l_@@_continous_color_tmpb_tl
                    }
                    {
                      \l_@@_numfading_color_i_tl!
                      \l_@@_continous_color_tmpb_tl!
                      \l_@@_numfading_color_ii_tl!
                      \fp_eval:n { 100 - \l_@@_continous_color_tmpb_tl }
                    }
              ] { \l_@@_continous_color_tmpc_tl }
          }
      }
    \group_end:
  }

\cs_new_protected:Npn \@@_continous_colorset_aux:NNN #1#2#3
  {
    \group_begin: \exp_args:NNNe \group_end:
    \tl_set:Nn #2 { \clist_item:Nn #1 { 1 } }
    \group_begin: \exp_args:NNNe \group_end:
    \tl_set:Nn #3 { \clist_item:Nn #1 { 2 } }
  }

\cs_new_protected:Npn \@@_continous_color_aux:nNN #1#2#3
  {
    \int_step_inline:nn { \tl_count:n {#1} }
      {
        \clist_put_right:Ne #2
          { \fp_eval:n { 100 - (##1 - 1) * 100 / \tl_count:n {#1} } }
        \clist_put_right:Ne #3
          { \fp_eval:n { 100 - ##1 * 100 / \tl_count:n {#1} } }
      }
  }

\file_input_stop:
from fontTools.ttLib import TTFont
from fontTools.pens.recordingPen import RecordingPen

from bezier_to_tikz import bezier_to_tikz



font = TTFont("../../Fonts/FandolSong-Regular.otf")
char = "你"

# CFF CharStrings('CFF' table only for OTF)
cff = font["CFF "].cff
top_dict = cff.topDictIndex[0]
charstrings = top_dict.CharStrings
glyph_name = font.getBestCmap().get(ord(char))
if not glyph_name:
    print(f"Font does NOT contain Glyph of '{char}'")
    exit()

# get contour (bezier path)
pen = RecordingPen()
charstrings[glyph_name].draw(pen)

def bezier_path(data: list):
    for cmd, pts in pen.value:
        print(cmd, pts)


res = bezier_to_tikz(pen.value, 0.001)
print(res)


#  Output data
# character '你':
# \path (0.036,0.229) -- (0.045,0.221) .. controls (0.094,0.271) and (0.130,0.314) .. (0.155,0.350) .. controls (0.180,0.386) and (0.200,0.418) .. (0.217,0.445) -- (0.217,0.017) -- (0.210,-0.161) .. controls (0.238,-0.154) and (0.262,-0.142) .. (0.282,-0.127) -- (0.276,0.008) -- (0.276,0.440) -- (0.301,0.454) .. controls (0.302,0.455) and (0.303,0.457) .. (0.303,0.458) .. controls (0.303,0.460) and (0.301,0.462) .. (0.298,0.464) -- (0.242,0.496) -- (0.273,0.554) .. controls (0.284,0.575) and (0.307,0.621) .. (0.340,0.693) -- (0.371,0.706) .. controls (0.376,0.708) and (0.378,0.710) .. (0.378,0.712) .. controls (0.379,0.713) and (0.376,0.716) .. (0.371,0.719) -- (0.282,0.770) -- (0.271,0.720) .. controls (0.266,0.695) and (0.251,0.648) .. (0.226,0.582) .. controls (0.201,0.514) and (0.176,0.458) .. (0.152,0.413) .. controls (0.128,0.368) and (0.089,0.306) .. (0.036,0.229) -- cycle (0.472,0.338) -- (0.457,0.287) .. controls (0.447,0.254) and (0.436,0.221) .. (0.423,0.189) .. controls (0.410,0.157) and (0.396,0.126) .. (0.381,0.096) .. controls (0.366,0.065) and (0.342,0.026) .. (0.309,-0.023) -- (0.320,-0.030) .. controls (0.353,0.007) and (0.380,0.038) .. (0.400,0.064) .. controls (0.419,0.089) and (0.439,0.118) .. (0.458,0.152) .. controls (0.478,0.184) and (0.501,0.224) .. (0.526,0.270) -- (0.554,0.277) .. controls (0.559,0.278) and (0.562,0.280) .. (0.562,0.282) .. controls (0.561,0.284) and (0.560,0.286) .. (0.557,0.288) -- cycle (0.327,0.298) -- (0.340,0.290) -- (0.355,0.310) -- (0.413,0.381) .. controls (0.440,0.416) and (0.472,0.462) .. (0.509,0.521) -- (0.847,0.521) -- (0.777,0.413) -- (0.787,0.406) .. controls (0.824,0.445) and (0.854,0.472) .. (0.876,0.486) .. controls (0.898,0.499) and (0.918,0.506) .. (0.936,0.508) .. controls (0.953,0.508) and (0.962,0.510) .. (0.964,0.514) .. controls (0.964,0.516) and (0.963,0.520) .. (0.960,0.523) -- (0.872,0.595) -- (0.832,0.544) -- (0.521,0.544) -- (0.597,0.696) -- (0.628,0.707) .. controls (0.633,0.709) and (0.636,0.711) .. (0.636,0.712) .. controls (0.637,0.713) and (0.634,0.716) .. (0.628,0.719) -- (0.544,0.768) -- (0.521,0.688) .. controls (0.512,0.661) and (0.497,0.620) .. (0.476,0.565) .. controls (0.455,0.510) and (0.434,0.465) .. (0.412,0.428) .. controls (0.392,0.391) and (0.363,0.348) .. (0.327,0.298) -- cycle (0.453,-0.077) .. controls (0.504,-0.094) and (0.535,-0.109) .. (0.544,-0.120) .. controls (0.554,-0.132) and (0.562,-0.146) .. (0.568,-0.163) .. controls (0.626,-0.148) and (0.657,-0.133) .. (0.660,-0.118) .. controls (0.664,-0.104) and (0.666,-0.087) .. (0.666,-0.068) -- (0.666,0.397) -- (0.698,0.424) .. controls (0.705,0.429) and (0.703,0.434) .. (0.694,0.438) -- (0.604,0.474) -- (0.606,0.357) -- (0.606,-0.041) .. controls (0.606,-0.060) and (0.604,-0.072) .. (0.600,-0.078) .. controls (0.596,-0.085) and (0.548,-0.080) .. (0.457,-0.065) -- cycle (0.733,0.311) .. controls (0.770,0.266) and (0.797,0.231) .. (0.814,0.206) .. controls (0.831,0.181) and (0.843,0.161) .. (0.850,0.146) .. controls (0.857,0.131) and (0.864,0.114) .. (0.870,0.096) .. controls (0.877,0.077) and (0.882,0.060) .. (0.886,0.044) .. controls (0.889,0.027) and (0.892,0.016) .. (0.894,0.008) .. controls (0.897,0.002) and (0.902,-0.002) .. (0.909,-0.003) .. controls (0.916,-0.004) and (0.924,0.000) .. (0.934,0.010) .. controls (0.942,0.019) and (0.949,0.030) .. (0.954,0.040) .. controls (0.958,0.052) and (0.960,0.061) .. (0.960,0.069) .. controls (0.961,0.100) and (0.942,0.135) .. (0.902,0.174) .. controls (0.864,0.212) and (0.810,0.260) .. (0.742,0.319) -- cycle;
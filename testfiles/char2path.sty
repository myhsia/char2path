%%
%% This is file `char2path.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% char2path.dtx  (with options: `package')
%% -----------------------------------------------------------------------
%%   Copyright (C) 2025 by Zongping Ding <zongpingding5@outlook.com> and *
%%                         Mingyu Xia    <myhsia@outlook.com>            *
%%                                                                       *
%%   This work may be distributed and/or modified under the conditions   *
%%   of the LaTeX Project Public License (LPPL), either version 1.3c of  *
%%   this license or (at your option) any later version.                 *
%%   The latest version of this license is in                            *
%%                                                                       *
%%       http://www.latex-project.org/lppl.txt                           *
%%                                                                       *
%%   and version 1.3c or later is part of all distributions of LaTeX     *
%%   version 2008 or later.                                              *
%%                                                                       *
%%   This work has the LPPL maintenance status `maintained'.             *
%%                                                                       *
%%   The Current Maintainer of this work is Zongping Ding and Mingyu Xia.*
%% -----------------------------------------------------------------------
\ProvidesExplPackage {char2path} {2025-08-01} {v1.0.1}
  {A LaTeX package that converts characters into TikZ paths}
\keys_define:nn { char2path }
  {
    scale   .tl_gset:N = \g__ctp_scale_tl,
      scale .initial:n = { 10pt },
  }
\ProcessKeyOptions [ char2path ]
\RequirePackage{tikz, etoolbox}
\patchcmd{\pgfutil@InputIfFileExists}
  { \input #1 }
  {
    \@pushfilename
    \xdef\@currname{#1}
    \input #1
    \@popfilename
  }{}{}
\usetikzlibrary{patterns, fadings, calc}
\cs_new_protected:Npn \__ctp_msg_new:nn #1#2
  { \msg_new:nnn { char2path } {#1} {#2} }
\cs_new_protected:Npn \__ctp_msg_warning:n #1
  { \msg_warning:nn { char2path } {#1} }
\cs_new_protected:Npn \__ctp_msg_error:nn #1#2
  { \msg_error:nne { char2path } {#1} {#2} }
\__ctp_msg_new:nn { fading } { Unsupport ~ multiple ~ fading ~ directions }
\__ctp_msg_new:nn { kernel } { file ~ not ~ found }
\tl_const:Nn \c__ctp_tikz_folder_tl { font_glyph }
\fp_const:Nn \c__ctp_global_scale_fp { .0135 }
\prop_const_from_keyval:Nn \c__ctp_scale_prop
  {
    10pt = 0.820, 11pt = 0.902, 12pt = 0.984, 13pt = 1.066,
    14pt = 1.148, 15pt = 1.230, 16pt = 1.311,
  }
\tl_new:N \l__ctp_tikz_data_merge_tl
\cs_new_protected_nopar:Npn \__ctp_load_font_data:nnn #1#2#3
  {
    \clist_map_inline:nn {#3}
      {
        \file_get:nnNTF
          { ctp-#2-##1.data.tex } { \char_set_catcode:nn { 126 } { 12 } }
          \l__ctp_tikz_data_single_tl
          {
            \tl_gput_right:NV \l__ctp_tikz_data_merge_tl
              \l__ctp_tikz_data_single_tl
          } { \__ctp_msg_error:nn { kernel } { ctp-#2-##1.data.tex } }
      }
    \exp_args:NnV \prop_const_from_keyval:cn
      { c__ctp_tikz_#2_data_prop } { \l__ctp_tikz_data_merge_tl }
    \tl_set:cn { l__ctp_font_#2_type_tl } {#1}
  }
\cs_new:Npn \__ctp_protected_char:nn #1#2
  { \cs_new_protected:cpn {#1} { \exp_not:n {#2} } }
\__ctp_protected_char:nn { ctpbackslash }{ \textbackslash }
\__ctp_load_font_data:nnn { serif }  { lmr }
  { arabic, alpha-small, alpha-caps, others, }
\__ctp_load_font_data:nnn { sans }   { lms }
  { arabic, alpha-small, alpha-caps, others, }
\__ctp_load_font_data:nnn { mono }   { lmm }
  { arabic, alpha-small, alpha-caps, others, }
\clist_new:N \l__ctp_hfading_color_left_clist
\clist_new:N \l__ctp_hfading_color_right_clist
\keys_define:nn { char2path / chartopath }
  {
    font      .tl_set:N     = \l__ctp_font_tl,
      font    .initial:n    = { lmm },
    rescan    .bool_set:N   = \l__ctp_rescan_bool,
      rescan  .initial:n    = { true },
    mono      .dim_set:N    = \l__ctp_mono_dim,
      mono    .initial:n    = { 0pt },
    draw      .tl_set:N     = \l__ctp_draw_tl,
      draw    .initial:n    = { none },
    fill      .tl_set:N     = \l__ctp_fill_tl,
    outline   .dim_set:N    = \l__ctp_outline_tl,
      outline .initial:n    = { 0pt },
    hfading   .clist_set:N  = \l__ctp_hfading_clist,
    vfading   .clist_set:N  = \l__ctp_vfading_clist,
    scale     .fp_set:N     = \l__ctp_scale_fp,
      scale   .initial:n    = { 1 },
    unknown   .code:n       = \__ctp_parse_unknown_option:n {#1}
  }
\clist_new:N \l__ctp_options_clist
\cs_new_protected_nopar:Npn \__ctp_parse_unknown_option:n #1
  {
    \tl_if_empty:nTF {#1}
      { \clist_put_right:NV \l__ctp_options_clist \l_keys_key_str }
      {
        \exp_args:NNx \clist_gput_right:Nn \l__ctp_options_clist
          { \l_keys_key_str = \exp_not:n {#1} }
      }
  }
\tl_new:N \l__ctp_tmpa_tl
\clist_new:N \l__ctp_hfading_keys_clist
\NewDocumentCommand \chartopath { O{} m }
  {
    \group_begin:
    \keys_set:nn { char2path / chartopath } {#1}
    \IfBlankT {#1} { \tl_set:Nn \l__ctp_draw_tl { black } }
    \bool_if:NTF \l__ctp_rescan_bool
      {
        \tl_set_rescan:Nnn \l__ctp_tmpa_tl
          {
            \char_set_catcode:nn { \int_from_hex:n { 24 } } { 12 }
            \char_set_catcode:nn { \int_from_hex:n { 26 } } { 12 }
            \char_set_catcode:nn { \int_from_hex:n { 5e } } { 12 }
            \char_set_catcode:nn { \int_from_hex:n { 5f } } { 12 }
            \char_set_catcode:nn { \int_from_hex:n { 7e } } { 12 }
          } {#2}
      } { \tl_set:Nn \l__ctp_tmpa_tl {#2} }
    \bool_lazy_and:nnT
      { !\clist_if_empty_p:N \l__ctp_hfading_clist }
      { !\clist_if_empty_p:N \l__ctp_vfading_clist }
      { \__ctp_msg_warning:n { fading } }
    \bool_lazy_or:nnTF
      {
        \bool_lazy_and_p:nn { \clist_if_empty_p:N \l__ctp_hfading_clist }
                            { \clist_if_empty_p:N \l__ctp_vfading_clist }
      }
      {
        \bool_lazy_and_p:nn { !\clist_if_empty_p:N \l__ctp_hfading_clist }
                            { !\clist_if_empty_p:N \l__ctp_vfading_clist }
      }
      {
        \exp_args:Nno \__ctp_aux:nnnnn
          {
            draw        = \l__ctp_draw_tl,  line~width  = \l__ctp_outline_tl,
            \tl_if_blank:VF \l__ctp_fill_tl { fill      = \l__ctp_fill_tl, },
            \clist_use:Nn \l__ctp_options_clist { , }
          } { \l__ctp_tmpa_tl } { \l__ctp_font_tl }
          { \l__ctp_scale_fp } { \l__ctp_mono_dim }
      }
      {
        \clist_if_empty:NF \l__ctp_vfading_clist
          {
            \__ctp_fading_parse_aux:NNN \l__ctp_vfading_clist
              \l__ctp_color_i_tl \l__ctp_color_ii_tl
            \str_case_e:nn { - }
              {
                { \l__ctp_color_i_tl }
                { \tl_set:Nn \l__ctp_color_i_tl { transparent!0 } }
                { \l__ctp_color_ii_tl }
                { \tl_set:Nn \l__ctp_color_ii_tl { transparent!0 } }
              }
            \__ctp_aux:nnnnn
              {
                top~color  = \l__ctp_color_i_tl, bottom~color = \l__ctp_color_ii_tl,
                line~width = \l__ctp_outline_tl, draw = \l__ctp_draw_tl,
                \clist_use:Nn \l__ctp_options_clist { , }
              } { \l__ctp_tmpa_tl } { \l__ctp_font_tl }
              { \l__ctp_scale_fp } { \l__ctp_mono_dim }
          }
        \clist_if_empty:NF \l__ctp_hfading_clist
          {
            \__ctp_fading_parse_aux:NNN \l__ctp_hfading_clist
              \l__ctp_color_i_tl \l__ctp_color_ii_tl
            \exp_args:Ne \__ctp_fading_color_aux:nNN { \l__ctp_tmpa_tl }
              \l__ctp_hfading_color_left_clist
              \l__ctp_hfading_color_right_clist
            \int_step_inline:nn { \exp_args:Ne \tl_count:n { \l__ctp_tmpa_tl } }
              {
                \tl_set:Nn \l__ctp_hfading_color_tmpa_tl
                  { \clist_item:Nn \l__ctp_hfading_color_left_clist {##1} }
                \tl_set:Nn \l__ctp_hfading_color_tmpb_tl
                  { \clist_item:Nn \l__ctp_hfading_color_right_clist {##1} }
                \str_case_e:nnF { - }
                  {
                    { \l__ctp_color_i_tl }
                    {
                      \clist_set:Nn \l__ctp_hfading_keys_clist
                        {
                          left~color  = \l__ctp_color_ii_tl!
                            \fp_eval:n { 100 - \l__ctp_hfading_color_tmpa_tl },
                          right~color = \l__ctp_color_ii_tl!
                            \fp_eval:n { 100 - \l__ctp_hfading_color_tmpb_tl }
                        }
                    }
                    { \l__ctp_color_ii_tl }
                    {
                      \clist_set:Nn \l__ctp_hfading_keys_clist
                        {
                          left~color  = \l__ctp_color_i_tl!
                          \l__ctp_hfading_color_tmpa_tl,
                          right~color = \l__ctp_color_i_tl!
                            \l__ctp_hfading_color_tmpb_tl
                        }
                    }
                  }
                  {
                    \clist_set:Nn \l__ctp_hfading_keys_clist
                      {
                        left~color  = \l__ctp_color_i_tl!
                          \l__ctp_hfading_color_tmpa_tl!\l__ctp_color_ii_tl,
                        right~color = \l__ctp_color_ii_tl!
                          \fp_eval:n { 100 - \l__ctp_hfading_color_tmpb_tl }!
                          \l__ctp_color_i_tl
                      }
                  }
                \exp_args:Nne \__ctp_aux:nnnnn
                  {
                    draw        = \l__ctp_draw_tl,
                    line~width  = \l__ctp_outline_tl,
                    \clist_use:Nn \l__ctp_hfading_keys_clist { , },
                    \clist_use:Nn \l__ctp_options_clist { , }
                  } { \exp_args:Ne \tl_item:nn { \l__ctp_tmpa_tl } {##1} }
                  { \l__ctp_font_tl } { \l__ctp_scale_fp } { \l__ctp_mono_dim }
              }
          }
      }
    \group_end:
    \clist_gclear:N \l__ctp_options_clist
  }
\dim_new:N \l__ctp_mono_width_dim
\dim_new:N \l__ctp_mono_sep_dim
\box_new:N \l__ctp_glyph_box
\prg_generate_conditional_variant:Nnn \str_case:nn { v } { F }
\cs_new_protected:Npn \__ctp_aux:nnnnn #1#2#3#4#5
  {
    \exp_args:Ne \tl_map_inline:nn {#2}
      {
        \str_case:vnF { l__ctp_font_#3_type_tl }
          {
            { serif }
            {
              \hbox_set:Nn \l__ctp_glyph_box { \rmfamily ##1 }
              \dim_set:Nn \l__ctp_mono_width_dim { 0pt }
              \dim_set:Nn \l__ctp_mono_sep_dim { .52pt }
            }
            { sans }
            {
              \hbox_set:Nn \l__ctp_glyph_box { \sffamily ##1 }
              \dim_set:Nn \l__ctp_mono_width_dim { 0pt }
              \dim_set:Nn \l__ctp_mono_sep_dim { .52pt }
            }
            { mono }
            {
              \hbox_set:Nn \l__ctp_glyph_box { \ttfamily ##1 }
              \dim_set:Nn \l__ctp_mono_width_dim { 5.124975pt }
              \dim_set:Nn \l__ctp_mono_sep_dim { 0pt }
            }
          } { \hbox_set:Nn \l__ctp_glyph_box {##1} }
        \dim_compare:nNnF {#5} = { 0pt }
          { \dim_set:Nn \l__ctp_mono_width_dim {#5} }
        \__ctp_draw:eennn
          {#1} { \__ctp_data:nn {#3} {##1} } {#4}
          { \l__ctp_mono_width_dim } { \l__ctp_mono_sep_dim }
      }
  }
\cs_new_protected:Npn \__ctp_draw:nnnnn #1#2#3#4#5
  {
    \tikz [ baseline = -.05pt ] \node
      [ anchor = base, minimum~width = #4 * \f@size/10, inner~sep = #5 * \f@size/10 ]
      { \tikz [ scale = \prop_item:Ne \c__ctp_scale_prop { \g__ctp_scale_tl } *
                        \fp_eval:n { \f@size/8.4 * \c__ctp_global_scale_fp * #3 }
              ] \path [#1] #2; };
  }
\cs_generate_variant:Nn \__ctp_draw:nnnnn { eennn }
\cs_new:Npn \__ctp_data:nn #1#2
  {
    \prop_if_in:cnTF { c__ctp_tikz_#1_data_prop } {#2}
      { \prop_item:cn { c__ctp_tikz_#1_data_prop } {#2} }
      { node [ draw, rounded~corners = .5pt, inner~xsep = -.06pt ] {?} }
    % \file_if_exist_input:n { \c__ctp_tikz_folder_tl/#2.pgf.coor }
  }
\cs_generate_variant:Nn \__ctp_data:nn { ne, ee }
\cs_new_protected:Npn \__ctp_fading_parse_aux:NNN #1#2#3
  {
    \group_begin: \exp_args:NNNe \group_end:
      \tl_set:Nn #2 { \clist_item:Nn #1 { 1 } }
    \group_begin: \exp_args:NNNe \group_end:
      \tl_set:Nn #3 { \clist_item:Nn #1 { 2 } }
  }
\cs_new_protected:Npn \__ctp_fading_color_aux:nNN #1#2#3
  {
    \int_step_inline:nn { \tl_count:n {#1} }
      {
        \clist_put_right:Ne #2
          {
            \fp_eval:n
              { 100 - (##1 - 1) * 100 / \tl_count:n {#1} }
          }
        \clist_put_right:Ne #3
          { \fp_eval:n { 100 - ##1 * 100 / \tl_count:n {#1} } }
      }
  }

\keys_define:nn { char2path / chartoclip }
  {
    font      .tl_set:N  = \l__ctp_clip_font_tl,
      font    .initial:n = { lmm },
    image     .tl_set:N  = \l__ctp_clip_image_tl,
      image   .initial:n = { example-image },
    scale     .fp_set:N  = \l__ctp_clip_scale_fp,
      scale   .initial:n = { 1 },
    anchor    .tl_set:N  = \l__ctp_clip_anchor_tl,
      anchor  .initial:n = { center },
    offset    .tl_set:N  = \l__ctp_clip_offset_tl,
      offset  .initial:n = { (0pt, 0pt) },
    height    .dim_set:N = \l__ctp_clip_height_tl,
      height  .initial:n = { 3cm },
  }
\NewDocumentCommand \chartoclip { O{} m }
  {
    \group_begin:
    \keys_set:nn { char2path / chartoclip }{#1}
    \exp_args:Nee \__ctp_image_clip_aux:nnnnnn
      { \prop_item:ce { c__ctp_tikz_ \l__ctp_clip_font_tl _data_prop } { #2 } }
      { \l__ctp_clip_offset_tl  } { \l__ctp_clip_image_tl   }
      { \l__ctp_clip_height_tl  } { \l__ctp_clip_scale_fp   }
      { \l__ctp_clip_anchor_tl  }
    \group_end:
  }
\cs_new:Npn \__ctp_image_clip_aux:nnnnnn #1#2#3#4#5#6
  {
    \tikz [ scale = \fp_eval:n { \f@size/8.4 * \c__ctp_global_scale_fp * #5 },
            baseline = -.05pt ]
      \path [ path~picture = {
              \node at ($(path~picture~bounding~box.#6) + #2$)
                { \includegraphics [ height = #4 ] {#3} };
          } ] #1;
  }
\newcommand \ctpdata [2] { \__ctp_data:nn {#1}{#2} }
\file_input_stop:
%% -----------------------------------------------------------------------
%%   This work consists of the files char2path.dtx,                      *
%%                                   ctp-lmdata.dtx,                     *
%%                                   char2path.ins,                      *
%%                 the derived files char2path.sty,                      *
%%                                   ctp-lmr-arabic.data.tex,            *
%%                                   ctp-lmr-alpha-small.data.tex,       *
%%                                   ctp-lmr-alpha-caps.data.tex,        *
%%                                   ctp-lmr-others.data.tex,            *
%%                                   ctp-lms-arabic.data.tex,            *
%%                                   ctp-lms-alpha-small.data.tex,       *
%%                                   ctp-lms-alpha-caps.data.tex,        *
%%                                   ctp-lms-others.data.tex,            *
%%                                   ctp-lmm-arabic.data.tex,            *
%%                                   ctp-lmm-alpha-small.data.tex,       *
%%                                   ctp-lmm-alpha-caps.data.tex,        *
%%                                   ctp-lmm-others.data.tex,            *
%%           the documentation files char2path.pdf,                      *
%%                               and README.md.                          *
%% -----------------------------------------------------------------------
%%
%% End of file `char2path.sty'.
